---
  - name: Setup Bastion Host
    hosts: localhost
    connection: local
    gather_facts: false
   
    tasks:
      - name: import vpc setup variables
        include_vars:
          file: vpc_setup.txt
      
      - name: import vpc output variables
        include_vars:
          file: vpc_setup.txt

  - name: keypair for bastion hosts
    ec2_key:
      name: " bastion_key "
      region: "{{ region }}"
      state: present
    register: keypair_out
  
  # - name: store keypair
  #   debug:
  #     var:  keypair_out

  # - name: save private key file
  #   copy:
  #     content: "{{ keypair_out.key.private_key }}"
  #     dest: "{{ keypair_out.key.name }}.pem"
  #     mode: 0400

  # - name: Create Security Group
  #   ec2_group:
  #     name: "{{ bastion_sg }}"
  #     description: "Security"
  #     region: "{{ region }}"
  #     vpc_id: "{{ vpcout.vpc.id }}"
  #     rules:
  #       - proto: tcp
  #         from_port: 22
  #         to_port: 22
  #         cidr_ip: "{{MYIP}}"
  # - debug:
  #     var: bastion_sg.group_id
  
  # - name: Create Bastion Host instance
  #   ec2_group:
  #     key_name: "bastion_key"
  #     instance_type: "t2.micro"
  #     image: "{{ bastion_ami }}"
  #     wait: true
  #     region: "{{ region }}"
  #     group_id: "{{ bastion_sg }}"
  #     wait_timeout: 300
  #     wait: yes
  #     instance_tags:
  #       Name: "bastion-host"
  #       Owner: "vprofile"
  #     exact_count: 1
  #     count_tag:
  #       Name: "bastion-host"
  #       Project: "vprofile"
  #       Owner: "vprofile"
  #       group_id: "{{ bastion_sg }}"
  #       vpc_subnet_id: "{{ pubsub1_out.subnet.id }}"
  #   register: bastion_out
      
